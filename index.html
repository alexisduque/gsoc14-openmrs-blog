
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>My GSOC 2014 Blog</title>
	<meta name="author" content="Alexis Duque">

	
	<meta name="description" content="Hi everyone, New week, and lot of updates ! First, I&rsquo;m proud to announce that we finally deploy Atlas 2.0 ! You can go to atlas.openmrs.org &hellip;">
	

	<link href="/atom.xml" rel="alternate" title="My GSOC 2014 Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
	

	
</head>

<body>
	<header id="header" class="inner"><nav><ul>
  <li><a href="/">Home</a></li>
  <li><a href="/timeline">Timeline</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul></nav>
</header>
	<div id="content" class="inner">


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/06/29/week-6/">Week 6</a></h1>
  
  








	
		<time datetime="2014-06-29T08:51:36+02:00">
			<span class="day">29</span><span class="month">Jun</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>Hi everyone,</p>

<p>New week, and lot of updates ! First, I&rsquo;m proud to announce that we finally deploy Atlas 2.0 ! You can go to <a href="http://atlas.openmrs.org">atlas.openmrs.org</a> and try it <img alt="smiley" src="/images/emoji/smiley.png" class="emoji" /></p>

<p>It has not been yet officially announced to the community so we can consider that is a beta version. Update are coming soon with bug fix and new features &hellip; <img alt="sweat_drops" src="/images/emoji/sweat_drops.png" class="emoji" /></p>

<p>That was also a good occasion to chat with helpdesk and know more about deployment process.</p>

<p>Moreover, as requested by Michael every GSoC student post their video presentation last week. So it was really nice to watch each one, to discover what&rsquo;s happen, and to know other people. We have so different projects, and interaction between use are probably insufficient.</p>

<h2>Atlas project</h2>

<p>Since last 2 weeks, I focus on Atlas Module and features I have to implement on the Atlas server, in order to authorize the module, handle ping with updates, &hellip;</p>

<p>An other task was to wrap up the User Interface of the module. Result in the following captures :</p>

<p><img src="/images/module-enabled.png" width="370" title="Atlas Module Enabled" > <img src="/images/module-disabled.png" width="370" title="Atlas Module Disabled" >
<img src="/images/show-counts.png" title="Show counts in Atlas" ></p>

<p><strong>Other Job done this week : </strong></p>

<ul>
<li>User can edit counts in Atlas Server</li>
<li>User can choose to show counts or not</li>
<li>FIX <a href="https://issues.openmrs.org/browse/ATLAS-83">ATLAS-83</a>, <a href="https://issues.openmrs.org/browse/ATLAS-84">ATLAS-84</a>, <a href="https://issues.openmrs.org/browse/ATLAS-85">ATLAS-85</a>, <a href="https://issues.openmrs.org/browse/ATLAS-86">ATLAS-86</a>, <a href="https://issues.openmrs.org/browse/ATLAS-87">ATLAS-87</a></li>
<li>Release Atlas server 2.0.1.</li>
<li>Refactor Atlas Module API.</li>
<li>Begin work on <a href="https://issues.openmrs.org/browse/ATLAS-88">ATLAS-88</a> : Add a simple SQL form to Atlas Server accessible only to admin.</li>
</ul>


<p>Next week, I will test Atlas Module on the staged server, and check that pings are correctly sent, authorization with module token working, &hellip;.</p>

<p><em>Alexis</em></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/06/21/mid-term/">Mid Term</a></h1>
  
  








	
		<time datetime="2014-06-21T13:41:32+02:00">
			<span class="day">21</span><span class="month">Jun</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>Unbelievable, mid-term is coming !! GSoC started 5 weeks ago, 5 weeks having fun, <strong>learning</strong> a lot, improving programming skills, knowing new guys in the <strong>community</strong>, making <strong>friends</strong>, &hellip;.
<strong>Thanks every one !</strong></p>

<p>This week was a bit special for me because I just finished the university semester, that means &hellip;.. <strong>EXAMS</strong>. <img alt="blue_book" src="/images/emoji/blue_book.png" class="emoji" />
So I spent less time chatting, or being focus on the project. But I finally could do some interesting job :</p>

<ul>
<li>Add routing and custom view when Atlas Server is visited from the module.</li>
<li>Log-in and authentication work-flow for the module, force user to log-in if module isn&rsquo;t attached to a site.</li>
<li>Attach/Detach the module to a site.</li>
<li>User can update site statistics in Atlas Server, without the module.</li>
<li>Module UI proposal.</li>
<li>Video presentation.</li>
</ul>


<p>This post is a bit shorter than others because I&rsquo;m preparing a video presentation that will describe precisely Atlas Project goals, and its progression.</p>

<p>So stay tunned <img alt="smirk" src="/images/emoji/smirk.png" class="emoji" /></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/06/14/week-4/">Week 4</a></h1>
  
  








	
		<time datetime="2014-06-14T12:08:13+02:00">
			<span class="day">14</span><span class="month">Jun</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>This week, I began working on Atlas Module, that is the second part of Atlas project . As a transition time, I spent lot of time planning what I have to do and brainstorming: what the module has to do, how the user will use it, what are user needs, how we can make it easy to use. In this task, my mentor is a precious help !  Burke always have good and original idea <img alt="smile" src="/images/emoji/smile.png" class="emoji" /></p>

<p>So to put it in a nutshell, that&rsquo;s what the module will do:</p>

<ul>
<li>Display Atlas Server with all these functionalities (sorting, create/edit marker, &hellip;).</li>
<li>Authenticate the module and request authorization for posting data.</li>
<li>Automatically send stats (#patients, modules enabled in OpenMRS instance, &hellip;) to Atlas server.</li>
<li>User should select which information he want to send.</li>
<li>User should activate/deactivate information sending.</li>
<li>User should create a new marker in the Atlas, connected to the Module.</li>
<li>User should pick an existing marker in the Atlas to connect it with the Module.</li>
</ul>


<h2>Module UI</h2>

<p> <em>Atlas Module is accessible as an App in OpenMRS EMR</em></p>

<p><img class="center" src="/images/atlas-module.png" width="800" title="Capture control" ></p>

<p><em>User need to log-in with an OpenMRS ID accountm first time, to connect a site to the module.</em></p>

<p><img class="left" src="/images/atlas-signin.png" width="800" title="Capture control" ></p>

<p><em>User can pick an existing site in the atlas</em></p>

<p><img class="left" src="/images/atlas-me.png" width="800" title="Capture control" ></p>

<p><em>User can configure wich data are send, or disable data sending</em></p>

<p><img class="left" src="/images/atlas-config.png" width="800" title="Capture control" ></p>

<h2>Next Week Planning</h2>

<ul>
<li>Finishing <em>Module view</em> in Atlas Server

<ul>
<li><em>pick a site</em></li>
<li><em>information message</em></li>
</ul>
</li>
<li>Make video presentation</li>
</ul>


<p>Next week will be busy for me because of my final exams. Sorry if I don&rsquo;t perform at 100% <img alt="smirk" src="/images/emoji/smirk.png" class="emoji" /></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/06/07/week-3/">Week 3</a></h1>
  
  








	
		<time datetime="2014-06-07T07:10:17+02:00">
			<span class="day"> 7</span><span class="month">Jun</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>Week 3 is ending soon and there are only 3 weeks before GSoC mi-term, time go so fast with OpenMRS ! <img alt="clock1" src="/images/emoji/clock1.png" class="emoji" /></p>

<p>For this week, goals are all reached, and I can do what I have planned, thanks to everybody help me fixing blockers, or answering questions.</p>

<ul>
<li>Reviewing and improving what I did last week.</li>
<li>Setup OpenMRS 2.0 and reference application on my local dev environment.</li>
<li>Restablish markers fading on Atlas.</li>
<li>Write documentation for Atlas server deployment.</li>
<li>Setup Atlas correctly on staged.</li>
<li>Make Atlas module 1.2 working across 1.x and 2.x OpenMRS version.</li>
<li>Put an app link on OpenMRS 2.</li>
</ul>


<h2>Community interactions</h2>

<p>My university planning let me participate in many daily scrum, and attend developer forum. Nice <img alt="smile" src="/images/emoji/smile.png" class="emoji" /></p>

<p>As I had some blockers setting up OpenMRS 2.0, I required Helpdesk intervention on stagged sever, so it was good reasons to chat with community members other than my mentor. And be active on the mailing list <img alt="smirk" src="/images/emoji/smirk.png" class="emoji" /></p>

<p>So what I can say is : <strong>Having problems helps make friends !</strong></p>

<h2>Tips</h2>

<p>Set up OpenMRS 2.0 on my laptop was really painful, and I probably can&rsquo;t do it with precious help of Rafa and Darius. <img alt="+1" src="/images/emoji/+1.png" class="emoji" />So, I would like to share what I have to do, if it can help.</p>

<p><strong> My config </strong></p>

<ul>
<li>Ubuntu 14.04</li>
<li>Java 1.8</li>
<li>MySQL</li>
<li>OpenMRS running over Jetty</li>
</ul>


<p><strong> The problems </strong></p>

<p>Reference application won&rsquo;t start. After running Jetty and doing first setup, I have a blank page at localhost/openmrs.
Error on Java version with a message like this : OpenMRS requires Java > 6, 1.8 is present <img alt="worried" src="/images/emoji/worried.png" class="emoji" /></p>

<p><strong> Solution </strong></p>

<ul>
<li>Clean everything related to OpenMRS previous install (openmrs database, temp files)</li>
<li>Clone 1.10.x branch of openmrs-core</li>
<li>Clone master of openmrs-distro-referenceapp</li>
<li>Switch to Java JDK and JRE v1.7:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'> sudo update-alternatives --config java
</span><span class='line'> sudo update-alternatives --config javac
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Follow this good <a href="https://wiki.openmrs.org/display/projects/Setting+Up+a+Development+Environment+for+OpenMRS+EMR+2.0">WIKI</a></li>
<li>Important : take care your database encoding is set to <code>utf8</code>, and collation to <code>utf8_unicode_ci</code>.</li>
<li>Run it</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='sh'><span class='line'><span class="nb">cd </span>openmrs-core/webapp
</span><span class='line'>mvn jetty:run
</span></code></pre></td></tr></table></div></figure>


<h2>Next Week Planning</h2>

<ul>
<li>Announce new OpenMRS Atlas.</li>
<li>Stay tuned for community comments, suggestions and improvement idea.</li>
<li>Bug fix : I hope not <img alt="smirk" src="/images/emoji/smirk.png" class="emoji" /></li>
<li>Plan work on Atlas module.</li>
</ul>


  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/06/01/week-2/">Week 2</a></h1>
  
  








	
		<time datetime="2014-06-01T06:32:38+02:00">
			<span class="day"> 1</span><span class="month">Jun</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>An other awesome week spend with OpenMRS and developer team. Atlas 2.0 is coming soon <img alt="smile" src="/images/emoji/smile.png" class="emoji" /></p>

<p>We expected we could deploy it on new host this week, but with with Memorial Day Monday and Ascension Day Tuesday and Friday, we couldn&rsquo;t.</p>

<p>But waiting for infrastructure means working locally, so I add a couple of nice functionalities in Atlas :</p>

<ul>
<li>Improve Archive and Sites changes tracking saving new informations : created_by, changed_by.</li>
<li>A designated Administrator can edit/move or delete any marker in Atlas.</li>
<li>A screen capture feature, for easily exporting Atlas map and markers to an HD .png image.</li>
<li>Grabbing some informations and reading wiki, about openMRS module compatibility across 1.x et 2.x version.</li>
<li>Remove CDN dependencies and use HTTPS instead of HTTP, for external links, as requested by Helpdesk.</li>
<li>Planning next weeks work on Atlas Module.</li>
</ul>


<p>  <img class="left" src="/images/capture.png" title="Capture control" ></p>

<h2>Community interactions</h2>

<p>As each week, if my university schedule let me,  I use to participate in Scrum daily, and I really like it. <img alt="+1" src="/images/emoji/+1.png" class="emoji" />
Know what developers do, how are going other student projects, or what are next OpenMRS goals and milestones (as new release) is interesting, and help me to feel as an OpenMRS community member.</p>

<p>Unfortunately, I missed Developer Forum, this week .
As Tuesday was holiday in France, I participate in a duathlon race (5km<img alt="running" src="/images/emoji/running.png" class="emoji" />+ 30km<img alt="bike" src="/images/emoji/bike.png" class="emoji" /> +5km<img alt="running" src="/images/emoji/running.png" class="emoji" /> &ndash; yes, I use km and not miles <img alt="stuck_out_tongue_closed_eyes" src="/images/emoji/stuck_out_tongue_closed_eyes.png" class="emoji" /> ), and I couldn&rsquo;t attend or chat with Burke. <img alt="confused" src="/images/emoji/confused.png" class="emoji" />.</p>

<p>Moreover, each time I post a question on Forum, I&rsquo;m really surprised how quickly community give me a answer. Thank every body. <img alt="+1" src="/images/emoji/+1.png" class="emoji" /> So, in the future, I will try to help as soon as I can answer or solve the problem.</p>

<h2>Technical Aspect</h2>

<p><img class="right" src="/images/phantomjs.png" title="PhantonJS" >
 I&rsquo;ve discovered a new tools, developing screen capture feature: PhantomJS. It&rsquo;s headless Webkit scriptable with JavaScript and Jquery. So, it renders webpages, can navigate on it, but never display them. It is often used for web testing, page scraping, or making screenshot.  In a future post, I will present how I use it to capture Atlas picture</p>

<h2>Next Week Planning</h2>

<ul>
<li>Meet with Burke for review my work.</li>
<li>Setup Atlas 2.0 on stagged server.</li>
<li>Write documentation for Helpdesk to deploy Atlas 2.0</li>
<li>Switch to Atlas Module, probably adding new dependencies and make Atlas 1.2 running with OpenMRS 2.0</li>
</ul>


<p><em>Ciao</em></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/05/26/week-planning/">Week Planning</a></h1>
  
  








	
		<time datetime="2014-05-26T08:06:05+02:00">
			<span class="day">26</span><span class="month">May</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>My TODO List for this Week #2 :</p>

<ul>
<li>Keep contact with Helpdesk about new Atlas server host.</li>
<li>Deploy Atlas 2.0.</li>
<li>Probably fix some little bugs</li>
<li>Add Admin capability to edit/delete all marker</li>
</ul>


  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/05/24/week-1/">Week 1</a></h1>
  
  








	
		<time datetime="2014-05-24T19:55:05+02:00">
			<span class="day">24</span><span class="month">May</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>Hi everyone <img alt="smile" src="/images/emoji/smile.png" class="emoji" /></p>

<p>If you miss the information,  GSOC just started this Monday ! This is my weekly update for this first week <em>having fun</em> with OpenMRS !</p>

<h2>Community interactions</h2>

<p>I&rsquo;ve participated in my first Daily Scrum on IRC, with other OpenMRS Dev and GSoC Students. Cool time, everyone tell what he did, what he plan to do, and if he has any blocker task. So we can keep posted what each other does, and ask for help if we have any problem or blocker.</p>

<p>Monday, I had a long chat we my mentor, to discuss what I have done on Atlas Server and how I can improve it.</p>

<p>We solve a blocker too : how we can manage authorization, marker creation and update from Atlas Server.</p>

<p>And Friday, regarding new features, and project progress, Burke said we will be able to deploy Atlas 2.0 to production server, probably next week: <img alt="earth_africa" src="/images/emoji/earth_africa.png" class="emoji" /></p>

<h2>Project Updated</h2>

<h3>Atlas Front-end</h3>

<ul>
<li>User can create a new marker in Atlas server.</li>
<li>User has a form in the bubble to edit bubble data.</li>
<li>Add a popup to confirm marker deletion.</li>
<li>Prevent sending openmrs_id and secret UUID (id) on the client side : only uuid of markers a user is allowed to edit is sended, others are kept secret.</li>
<li>Cleaning up JS code.</li>
</ul>


<h3>Database</h3>

<p>Actually, Atlas Module create a UUID, used as a token to authenticate the module and allow data update (#patients, OpenMRS Version, Installed modules, &hellip;). This UUID is used too, as Primary Key in the database and is never send to the client on the Atlas (remember is secret !).</p>

<p><strong>The Solution</strong> : Burke suggested me to create a table AUTH to define marker update permissions. Both users and modules will update or remove a marker (human/non-human): what is refering to <em>principal</em> concept. This extra Auth table allow the possibility to have multiple users with different permissions, to update a marker.</p>

<ul>
<li>Added <strong>openrmrs_id</strong> column in <strong>atlas table</strong> to register marker ownership.</li>
<li>An <strong>Auth row</strong> is linked to <strong>Atlas row</strong> with the Foreign Key <strong>atlas_id</strong> &ndash;> <strong>id</strong></li>
<li>All these changes has been done using Laravel Migration, a very useful tool for database versioning. It&rsquo;s a bit a PHP clone of <em>Liquibase</em></li>
</ul>


<p><strong>Database Schema</strong></p>

<p><img class="left" src="/images/db.png" title="New database schema" ></p>

<h3>Atlas Back-end</h3>

<ul>
<li>Replace PDO Query to <strong>Laravel QueryBuilder</strong> : <em>(less verbose, protect against SQL injection)</em>.</li>
<li>Move Ping and Data functions to Controllers instead of View.</li>
<li>Implements <em>marker persistence</em> and <em>authorization</em>.
Goodg job, for this first week !</li>
</ul>


<p>See you :&ndash;)</p>

<p><em>Alex</em></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/05/17/multipass-and-sso/">Multipass and SSO</a></h1>
  
  








	
		<time datetime="2014-05-17T11:45:50+02:00">
			<span class="day">17</span><span class="month">May</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>The first challenge of this summer of code is to authenticate a user &ndash; with his OpenMRS ID &ndash; directly inside Atlas website.</p>

<h2>What is OpenMRS ID</h2>

<p>OpenMRS ID is the system of user management used by the <strong>OpenMRS Community</strong>. User accounts are managed and created using the OpenMRS ID Dashboard, a web app written in <strong>Node.js</strong>.
Data model is built around <strong>LDAP</strong> user object and stored on an OpenLDAP server. In order to support unified authentication for all OpenMRS sites and external services, ID Dashboard also provides a <strong>SSO endpoints</strong>.</p>

<h2>What is SSO</h2>

<p><strong>Single Sign On</strong> (SSO) is a session/user authentication process that allows a user to provide his credentials once in order to access multiple applications. The single sign on authenticates the user to access all the applications he has been authorized to access. It eliminates future authenticaton requests when the user switches applications during that particular session.</p>

<p>Various implemention and straegies exist, such as <strong>OAuth</strong>, <strong>SAML</strong>, <strong>Multipass</strong>, <strong>CAS</strong> or <strong>Facebook Connect</strong>. Actually, ID Dashboard only support Multipass strategy but a project aimed to make a REST API based on OAuth and OpenID.</p>

<h2>What is Multipass and how we use it</h2>

<p>In order to authenticate users, OpenMRS ID dashboard pass an encrypted multipass JSON hash with the user&rsquo;s information to Atlas site. When the multipass token is received, an associated user record is created, with the information provided, and logged in current session using cookie.</p>

<p>A multipass hash is an <strong>AES encrypted JSON</strong> hash with the following attributes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;uid&quot;</span><span class="o">:</span> <span class="s2">&quot;19238333&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;expires&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-12-29T10:25:28-08:00&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;user_email&quot;</span><span class="o">:</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;user_name&quot;</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>How it is implemented ?</h2>

<p><strong>Multipass</strong> is build and encrypted on the ID Dashboard side wih <strong>Node.js</strong>.
On the other side, Atlas server check and decode multipass with a <strong>PHP implementation</strong> and <strong>mcrypt</strong> library.</p>

<figure class='code'><figcaption><span>Atlas Server Decode Multipass linenos:false</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">decodeMultipass</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;multipass&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">$signature</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">$iv</span> <span class="o">=</span> <span class="s1">&#39;OpenSSL for Node&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$subdomain</span> <span class="o">=</span> <span class="nv">$SITE_KEY</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$api_key</span> <span class="o">=</span> <span class="nv">$API_KEY</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$salted</span> <span class="o">=</span> <span class="nv">$api_key</span> <span class="o">.</span> <span class="nv">$subdomain</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$digest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="nv">$salted</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$key</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$digest</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$blocksize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Signature Verification</span>
</span><span class='line'>  <span class="nv">$hash</span> <span class="o">==</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">&quot;sha1&quot;</span><span class="p">,</span> <span class="nv">$token</span><span class="p">,</span> <span class="nv">$api_key</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nv">$hash</span> <span class="o">=</span> <span class="nv">$signature</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Replace _ with / and - with +</span>
</span><span class='line'>      <span class="nv">$token</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/_/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$token</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\-/&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$token</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Decrypt Token</span>
</span><span class='line'>      <span class="nv">$cipher</span> <span class="o">=</span> <span class="nb">mcrypt_module_open</span><span class="p">(</span><span class="nx">MCRYPT_RIJNDAEL_128</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;cbc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nb">mcrypt_generic_init</span><span class="p">(</span><span class="nv">$cipher</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$iv</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$decrypted</span> <span class="o">=</span> <span class="nb">mdecrypt_generic</span><span class="p">(</span><span class="nv">$cipher</span><span class="p">,</span><span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Remove invisble character</span>
</span><span class='line'>      <span class="nv">$decrypted</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$decrypted</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">..</span><span class="se">\x1F</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$userToken</span>  <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$decrypted</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/05/17/week-1/">Week -1</a></h1>
  
  








	
		<time datetime="2014-05-17T06:21:54+02:00">
			<span class="day">17</span><span class="month">May</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>Hey, let&rsquo;s start for a pre-start weekly report ! As mentioned in my previous post, goals this week were to wrap up the timeline and UI, fixing priorities and begin coding (officially not really ;&ndash;)
So, week starts with a cool hangout with my mentor. Talking with Burke is really a nice time, a good exercise for me to practise my spoken english, and to be more comfortable with OpenMRS developers community.</p>

<p>Burke gave grant me access to a dev server (Ubuntu 14.04 <img alt="+1" src="/images/emoji/+1.png" class="emoji" />) hosted by DigitalOcean. Abolutely unknown Cloud provider in France ! I will often push my work to share it with OpenMRS developers. You can have a look here : <a href="http://107.170.156.44">Atlas Server 2.0</a>.</p>

<p>On other hand, we have interesting email discussions with Elliott, about SSO, Auth stategy, and <a href="https://wiki.openmrs.org/display/projects/OpenMRS+ID+Platform+Improvements">OpenMRS ID project</a> (assigned to Wiehwa). As I&rsquo;m really interested in security topics, it was really cool. Elliott looks to be an expert and I learnt a lot. <img alt="bowtie" src="/images/emoji/bowtie.png" class="emoji" /></p>

<p><strong>What has been done this week :</strong></p>

<ul>
<li>Refactoring Atlas Server with Laravel</li>
<li>Atlas multipass auth strategy, allowing a user to authenticate with his OpenMRS ID in Altas Server.</li>
<li>Add a dropdown menu providing controls for future marker management function.</li>
<li>Add icons (trash, pencil, pad lock) on the bottom right corner of marker bubble.</li>
</ul>


<p><img class="left" src="/images/menu.png" title="New dropdown menu" >
<img class="center" src="/images/bubble-me.png" title="User owned marker" >
<img class="right" src="/images/bubble.png" title="A maker bubble" ></p>

<p><strong>Next Week Planning : </strong></p>

<ul>
<li>Discuss Atlas database re-designing.</li>
<li>User can create and edit a new marker (marker data not yet saved, just UI).</li>
</ul>


<p> See you next week with update.  <img alt="smirk" src="/images/emoji/smirk.png" class="emoji" /></p>

<p> <em>Alex</em></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


	<article class="post"><header>
  
  <h1 class="title"><a href="/blog/2014/05/09/weeks-2/">Week -2</a></h1>
  
  








	
		<time datetime="2014-05-09T13:04:00+02:00">
			<span class="day"> 9</span><span class="month">May</span>
		</time>
	

</header>
<div class="entry-content">
  
    <p>We are ten days before official GSOC begining , and I&rsquo;m so impatient to start !</p>

<p>This week was a productive week <img alt="+1" src="/images/emoji/+1.png" class="emoji" /></p>

<ul>
<li>First hangout with Burke, my mentor. It was really nice to see and chat with him, even if I am a bit shy <img alt="relaxed" src="/images/emoji/relaxed.png" class="emoji" /></li>
<li>Timeline adjustement.</li>
<li>New mockup and screenshot.</li>
<li>Discussion about SSO strategies for OpenMRS ID sign-in within Atlas Server.</li>
<li>I set up a local instance of OpenMRS ID Dashboard. I was a bit painful with OpenLDAP configuration, but I&rsquo;m now ready to test authentification. <img alt="sweat_smile" src="/images/emoji/sweat_smile.png" class="emoji" /></li>
<li>Some hack around SSO and multipass implementation for atlas.</li>
<li>I Start to refactor Atlas Server with Laravel, a great PHP Framework.</li>
</ul>


<p><strong>TODO</strong></p>

<ul>
<li>Review mockups with Burke</li>
<li>Finish Atlas upgrade to Laravel</li>
<li>Timeline wrapping up</li>
</ul>


<p>  <em>Alex</em></p>

  
  
  <footer class="meta">
    



    
  </footer>
  
</div>

</article>


<nav id="pagenavi">
	
	<a href="/blog/page/2/" class="next alignright">Next</a>
 <div class="clearfix"></div>
</nav>
</div>
	<footer id="footer" class="inner"><div class="social alignright">
	
	
	
	<a class="twitter" href="http://twitter.com/alexis0duque" title="Twitter">Twitter</a>
	
	
	<a class="github" href="https://github.com/alexisduque" title="GitHub">GitHub</a>
	
	
	<a class="rss" href="/atom.xml" title="RSS">RSS</a>
</div>
<p>&copy; 2014 Alexis Duque</p>
<div class="clearfix"></div></footer>
	<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
	(function($){
		$('.entry-content').each(function(i){
			var _i = i;
			$(this).find('img').each(function(){
				var alt = $(this).attr('alt');

				if (alt == '' || typeof alt == 'undefined'){
					$(this).wrap('<a href="'+$(this).attr('src')+'" class="fancybox" rel="gallery'+_i+'" />');
				} else {
					$(this).after('<span class="caption">'+alt+'</span>').wrap('<a href="'+$(this).attr('src')+'" class="fancybox" title="'+alt+'" rel="gallery'+_i+'" />');
				}
			});
		});
		$('.fancybox').fancybox();
	})(jQuery);
</script>
<div id="phasebeam">
	<canvas></canvas>
	<canvas></canvas>
	<canvas></canvas>
</div>
<script src="/javascripts/phasebeam.js"></script>




</body>
</html>