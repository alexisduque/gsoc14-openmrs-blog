<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[My GSOC 2014 Blog]]></title>
  <link href="http://alexisduque.github.io/atom.xml" rel="self"/>
  <link href="http://alexisduque.github.io/"/>
  <updated>2014-05-17T14:23:22+02:00</updated>
  <id>http://alexisduque.github.io/</id>
  <author>
    <name><![CDATA[Alexis Duque]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Multipass and SSO]]></title>
    <link href="http://alexisduque.github.io/blog/2014/05/17/multipass-and-sso/"/>
    <updated>2014-05-17T11:45:50+02:00</updated>
    <id>http://alexisduque.github.io/blog/2014/05/17/multipass-and-sso</id>
    <content type="html"><![CDATA[<p>The first challenge of this summer of code is to authenticate a user &ndash; with his OpenMRS ID &ndash; directly inside Atlas website.</p>

<h2>What is OpenMRS ID</h2>

<p>OpenMRS ID is the system of user management used by the <strong>OpenMRS Community</strong>. User accounts are managed and created using the OpenMRS ID Dashboard, a web app written in <strong>Node.js</strong>.
Data model is built around <strong>LDAP</strong> user object and stored on an OpenLDAP server. In order to support unified authentication for all OpenMRS sites and external services, ID Dashboard also provides a <strong>SSO endpoints</strong>.</p>

<h2>What is SSO</h2>

<p><strong>Single Sign On</strong> (SSO) is a session/user authentication process that allows a user to provide his credentials once in order to access multiple applications. The single sign on authenticates the user to access all the applications he has been authorized to access. It eliminates future authenticaton requests when the user switches applications during that particular session.</p>

<p>Various implemention and straegies exist, such as <strong>OAuth</strong>, <strong>SAML</strong>, <strong>Multipass</strong>, <strong>CAS</strong> or <strong>Facebook Connect</strong>. Actually, ID Dashboard only support Multipass strategy but a project aimed to make a REST API based on OAuth and OpenID.</p>

<h2>What is Multipass and how we use it</h2>

<p>In order to authenticate users, OpenMRS ID dashboard pass an encrypted multipass JSON hash with the user&rsquo;s information to Atlas site. When the multipass token is received, an associated user record is created, with the information provided, and logged in current session using cookie.</p>

<p>A multipass hash is an <strong>AES encrypted JSON</strong> hash with the following attributes:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="s2">&quot;uid&quot;</span><span class="o">:</span> <span class="s2">&quot;19238333&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;expires&quot;</span><span class="o">:</span> <span class="s2">&quot;2014-12-29T10:25:28-08:00&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;user_email&quot;</span><span class="o">:</span> <span class="s2">&quot;john@example.com&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="s2">&quot;user_name&quot;</span><span class="o">:</span> <span class="s2">&quot;John&quot;</span><span class="p">,</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>How it is implemented ?</h2>

<p><strong>Multipass</strong> is build and encrypted on the ID Dashboard side wih <strong>Node.js</strong>.
On the other side, Atlas server check and decode multipass with a <strong>PHP implementation</strong> and <strong>mcrypt</strong> library.</p>

<figure class='code'><figcaption><span>Atlas Server Decode Multipass linenos:false</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="k">public</span> <span class="k">function</span> <span class="nf">decodeMultipass</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nv">$token</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;multipass&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">$signature</span> <span class="o">=</span> <span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;signature&#39;</span><span class="p">];</span>
</span><span class='line'>  <span class="nv">$iv</span> <span class="o">=</span> <span class="s1">&#39;OpenSSL for Node&#39;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="nv">$subdomain</span> <span class="o">=</span> <span class="nv">$SITE_KEY</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$api_key</span> <span class="o">=</span> <span class="nv">$API_KEY</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$salted</span> <span class="o">=</span> <span class="nv">$api_key</span> <span class="o">.</span> <span class="nv">$subdomain</span><span class="p">;</span>
</span><span class='line'>  <span class="nv">$digest</span> <span class="o">=</span> <span class="nb">hash</span><span class="p">(</span><span class="s1">&#39;sha1&#39;</span><span class="p">,</span> <span class="nv">$salted</span><span class="p">,</span> <span class="k">true</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$key</span> <span class="o">=</span> <span class="nx">substr</span><span class="p">(</span><span class="nv">$digest</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">16</span><span class="p">);</span>
</span><span class='line'>  <span class="nv">$blocksize</span> <span class="o">=</span> <span class="mi">16</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// Signature Verification</span>
</span><span class='line'>  <span class="nv">$hash</span> <span class="o">==</span> <span class="nb">base64_encode</span><span class="p">(</span><span class="nb">hash_hmac</span><span class="p">(</span><span class="s2">&quot;sha1&quot;</span><span class="p">,</span> <span class="nv">$token</span><span class="p">,</span> <span class="nv">$api_key</span><span class="p">,</span> <span class="k">true</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nv">$hash</span> <span class="o">=</span> <span class="nv">$signature</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// Replace _ with / and - with +</span>
</span><span class='line'>      <span class="nv">$token</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/_/&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$token</span> <span class="o">=</span> <span class="nb">preg_replace</span><span class="p">(</span><span class="s1">&#39;/\-/&#39;</span><span class="p">,</span> <span class="s1">&#39;+&#39;</span><span class="p">,</span> <span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$token</span> <span class="o">=</span> <span class="nb">base64_decode</span><span class="p">(</span><span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Decrypt Token</span>
</span><span class='line'>      <span class="nv">$cipher</span> <span class="o">=</span> <span class="nb">mcrypt_module_open</span><span class="p">(</span><span class="nx">MCRYPT_RIJNDAEL_128</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;cbc&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nb">mcrypt_generic_init</span><span class="p">(</span><span class="nv">$cipher</span><span class="p">,</span> <span class="nv">$key</span><span class="p">,</span> <span class="nv">$iv</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nv">$decrypted</span> <span class="o">=</span> <span class="nb">mdecrypt_generic</span><span class="p">(</span><span class="nv">$cipher</span><span class="p">,</span><span class="nv">$token</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Remove invisble character</span>
</span><span class='line'>      <span class="nv">$decrypted</span> <span class="o">=</span> <span class="nx">trim</span><span class="p">(</span><span class="nv">$decrypted</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\x00</span><span class="s2">..</span><span class="se">\x1F</span><span class="s2">&quot;</span><span class="p">);</span>
</span><span class='line'>      <span class="nv">$userToken</span>  <span class="o">=</span> <span class="nb">json_decode</span><span class="p">(</span><span class="nv">$decrypted</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>



]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Week -1]]></title>
    <link href="http://alexisduque.github.io/blog/2014/05/17/week-1/"/>
    <updated>2014-05-17T06:21:54+02:00</updated>
    <id>http://alexisduque.github.io/blog/2014/05/17/week-1</id>
    <content type="html"><![CDATA[<p>Hey, let&rsquo;s start for a pre-start weekly report ! As mentioned in my previous post, goals this week were to wrap up the timeline and UI, fixing priorities and begin coding (officially not really ;&ndash;)
So, week starts with a cool hangout with my mentor. Talking with Burke is really a nice time, a good exercise for me to practise my spoken english, and to be more comfortable with OpenMRS developers community.</p>

<p>Burke gave grant me access to a dev server (Ubuntu 14.04 :+1:) hosted by DigitalOcean. Abolutely unknown Cloud provider in France ! I will often push my work to share it with OpenMRS developers. You can have a look here : <a href="http://107.170.156.44">Atlas Server 2.0</a>.</p>

<p>On other hand, we have interesting email discussions with Elliott, about SSO, Auth stategy, and <a href="https://wiki.openmrs.org/display/projects/OpenMRS+ID+Platform+Improvements">OpenMRS ID project</a> (assigned to Wiehwa). As I&rsquo;m really interested in security topics, it was really cool. Elliott looks to be an expert and I learnt a lot. :bowtie:</p>

<p><strong>What has been done this week :</strong></p>

<ul>
<li>Refactoring Atlas Server with Laravel</li>
<li>Atlas multipass auth strategy, allowing a user to authenticate with his OpenMRS ID in Altas Server.</li>
<li>Add a dropdown menu providing controls for future marker management function.</li>
<li>Add icons (trash, pencil, pad lock) on the bottom right corner of marker bubble.</li>
</ul>


<p><img class="left" src="http://alexisduque.github.io/images/menu.png" title="New dropdown menu" >
<img class="center" src="http://alexisduque.github.io/images/bubble-me.png" title="User owned marker" >
<img class="right" src="http://alexisduque.github.io/images/bubble.png" title="A maker bubble" ></p>

<p><strong>Next Week Planning : </strong></p>

<ul>
<li>Discuss Atlas database re-designing.</li>
<li>User can create and edit a new marker (marker data not yet saved, just UI).</li>
</ul>


<p> See you next week with update.  :smirk:</p>

<p> <em>Alex</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Week -2]]></title>
    <link href="http://alexisduque.github.io/blog/2014/05/09/weeks-2/"/>
    <updated>2014-05-09T13:04:00+02:00</updated>
    <id>http://alexisduque.github.io/blog/2014/05/09/weeks-2</id>
    <content type="html"><![CDATA[<p>We are ten days before official GSOC begining , and I&rsquo;m so impatient to start !</p>

<p>This week was a productive week :+1:</p>

<ul>
<li>First hangout with Burke, my mentor. It was really nice to see and chat with him, even if I am a bit shy :relaxed:</li>
<li>Timeline adjustement.</li>
<li>New mockup and screenshot.</li>
<li>Discussion about SSO strategies for OpenMRS ID sign-in within Atlas Server.</li>
<li>I set up a local instance of OpenMRS ID Dashboard. I was a bit painful with OpenLDAP configuration, but I&rsquo;m now ready to test authentification. :sweat_smile:</li>
<li>Some hack around SSO and multipass implementation for atlas.</li>
<li>I Start to refactor Atlas Server with Laravel, a great PHP Framework.</li>
</ul>


<p><strong>TODO</strong></p>

<ul>
<li>Review mockups with Burke</li>
<li>Finish Atlas upgrade to Laravel</li>
<li>Timeline wrapping up</li>
</ul>


<p>  <em>Alex</em></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Community Bonding and Planning]]></title>
    <link href="http://alexisduque.github.io/blog/2014/05/01/community-bonding-and-planning/"/>
    <updated>2014-05-01T12:53:40+02:00</updated>
    <id>http://alexisduque.github.io/blog/2014/05/01/community-bonding-and-planning</id>
    <content type="html"><![CDATA[<p>Before I start coding and working really on Atlas project, I began to plan my work, precising project timeline, and functionnalities I will implement this summer.</p>

<p>So during these few weeks of community bonding, with the precious help of Burke, I will design some protoypes, mockups and user stories to have a clear idea of how a user will interact with new Atlas Module release.</p>

<p><strong> See you next week ! </strong> :smile:</p>

<p><em>PS : Maybe I will post a quick introduction to Multipass SSO. I&rsquo;m getting some documentation about it, to be able to work with. I thought it&rsquo;s a good idea sharing new skills with you :&ndash;)</em></p>

<h2>Here is a first Timeline prototype :</h2>

<h3>21 April – 18 May</h3>

<ul>
<li>Getting familiar with Atlas Module and OpenMRS ID SSO <strong><em>(work in progress)</em></strong></li>
<li>Fixing some Atlas related Tickets <strong><em>(done)</em></strong></li>
<li>Designing the project Road Map <strong><em>(work in progress)</em></strong>

<ul>
<li>Story Board</li>
<li>Mockup</li>
<li>Timeline week by week</li>
</ul>
</li>
<li>Community bonding participating in community events <strong><em>(work in progress)</em></strong></li>
</ul>


<h3>19 May – 31 May</h3>

<ul>
<li>Add Sign In form for OpenMRS ID</li>
<li>Add OpenMRS ID SSO dependency in Atlas Module.</li>
</ul>


<h3>1 June 1 – 30 June</h3>

<ul>
<li>User can sign in successfully with his OpenMRS ID in Atlas Module</li>
<li>Atlas Module ported to OpenRMS 2.0 (whith a look like google app style)</li>
</ul>


<h3>1 July – 12 July</h3>

<ul>
<li>An existing marker can be associated with an OpenMRS ID in Atlas Module.</li>
<li>Add function to &ldquo;recover&rdquo; control of a marker using the registered OpenMRS ID
A marker can be created and updated directly in the Atlas Server.</li>
</ul>


<h3>13 July – 26 July</h3>

<ul>
<li>New administrative screens in Atlas Server to manage markers (move, remove outdated or invalid markers)</li>
</ul>


<h3>10 August – 15 August</h3>

<ul>
<li>Extra features in Atlas Server : map exporting as a slide for presentation, marker filtering by type or version</li>
</ul>


<h3>16 August – 22 August</h3>

<ul>
<li>Wrapping up project, final touches.</li>
<li>Writing Wiki and developer doc.</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Selected for GSoC 2014 with OpenMRS]]></title>
    <link href="http://alexisduque.github.io/blog/2014/04/22/selected-for-gsoc-2014-with-openmrs/"/>
    <updated>2014-04-22T20:16:28+02:00</updated>
    <id>http://alexisduque.github.io/blog/2014/04/22/selected-for-gsoc-2014-with-openmrs</id>
    <content type="html"><![CDATA[<p><img src="http://openmrs.org/wp-content/uploads/2013/07/OpenMRS-logo.svg" alt="" /></p>

<p>I&rsquo;m proud to announce that I&rsquo;ve been choosen as <strong>Google Summer of Code 2014</strong> student to code this summer with <strong>OpenMRS</strong> !</p>

<p>Thanks for the community to trust me. Now, I will do my best effort to make this project a success, to become an active member of OpenMRS contributor community.</p>

<p>Thanks to <strong>Burke, my mentor</strong>, for giving me some tips writing my proposal.
I&rsquo;m <strong>very excited</strong> to start working together :&ndash;)</p>

<p>See you soon, for detailed timeline and weekly news about the <strong>Atlas Module Project</strong> !</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[OpenMRS Atlas Module 2.0]]></title>
    <link href="http://alexisduque.github.io/blog/2014/03/18/openmrs-atlas-module-2-dot-0/"/>
    <updated>2014-03-18T10:37:13+01:00</updated>
    <id>http://alexisduque.github.io/blog/2014/03/18/openmrs-atlas-module-2-dot-0</id>
    <content type="html"><![CDATA[<h3>Project Introduction</h3>

<p><img src="https://1-ps.googleusercontent.com/sx/s.google-melange.appspot.com/www.google-melange.com/soc/content/2-1-20140317-p1/images/gsoc/logo/920x156xbanner-gsoc2014.png.pagespeed.ic.gdr4t3Igca.png" alt="" /></p>

<p><strong>Atlas Module</strong> has been developed during GSoC 2011, as a module, but because of various reasons, it hasn’t been yet used a lot.</p>

<p>This project aims to make a version of the Atlas Module to be distributed within <strong>OpenMRS 2.0</strong> as an app, including an implementation&rsquo;s marker to be associated with an <strong>OpenMRS ID</strong>, allowing for a the marker to be created or revised outside of the module, directly on the Atlas Website.</p>

<p>To easilier manage markers, <strong>Atlas website</strong> backend will be modified with new functionnalities, allowing to delete, or move markers.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[About Me]]></title>
    <link href="http://alexisduque.github.io/blog/2014/03/18/about-me/"/>
    <updated>2014-03-18T09:18:46+01:00</updated>
    <id>http://alexisduque.github.io/blog/2014/03/18/about-me</id>
    <content type="html"><![CDATA[<h4>E-mail: <a href="&#109;&#x61;&#105;&#x6c;&#x74;&#x6f;&#58;&#97;&#x6c;&#101;&#120;&#105;&#x73;&#x64;&#x36;&#49;&#64;&#x67;&#x6d;&#x61;&#105;&#x6c;&#x2e;&#99;&#x6f;&#109;">&#x61;&#x6c;&#x65;&#x78;&#105;&#x73;&#100;&#54;&#x31;&#64;&#x67;&#x6d;&#97;&#x69;&#108;&#46;&#x63;&#x6f;&#x6d;</a></h4>

<p>I am studying for a Masters Degree in Software Engineering and Telecoms, at the INSA de Lyon, an Engineering School in France.</p>

<p>I&rsquo;m interested in software and web development and particularly focus on middlewares and web API designing. So I have good Java and Java EE skills (Spring Framework, JPA, REST). and PHP (Symfony2) too .</p>

<p>I have a part-time job as a junior developer (web and middlewares) at ETIC INSA Technologies, the INSA Lyon junior company.</p>

<p>Actually, with 2 other guys, we are developing a geo-tracking server and web app,  for an important sport event organized in April by my university ( RAID INSA Lyon).
Hobbies : I practise Triathlon, and I&rsquo;m a good 10 km runner.</p>
]]></content>
  </entry>
  
</feed>
